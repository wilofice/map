<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Map MVC - SQLite Enhanced</title>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/main-styles.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/progress-styles.css">
    <link rel="stylesheet" href="css/notification-styles.css">
    <link rel="stylesheet" href="css/modal-styles.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="top-bar" id="topBar">
        <!-- Center Section: Project info and main controls -->
        <div class="top-bar-section center-section">
            <div class="project-info">
                <span class="folder-icon">ğŸ’¾</span>
                <span class="project-name" id="currentProjectName">No project loaded</span>
            </div>

            <!-- Quick Assign to Collection -->
            <div class="assign-collection" id="assignCollection" title="Move this project to a collection" style="display: none;">
                <select class="assign-select" id="assignCollectionSelect">
                    <option value="">Move to collectionâ€¦</option>
                    <option value="__none">â€” Remove from collection â€”</option>
                </select>
            </div>

            <!-- Quick Project Actions -->
            <div class="action-buttons" id="actionButtons">
                <button class="top-btn" id="switchProjectBtn" title="Switch to another project">ğŸ”„</button>
                <button class="top-btn" id="newProjectBtn" title="New Project">â•</button>
                <button class="top-btn" id="newCollectionBtn" title="New Collection">ğŸ“š</button>
                <button class="top-btn" id="importJsonBtn" title="Import JSON">ğŸ“</button>
                <button class="top-btn" id="searchProjectsBtn" title="Search Projects">ğŸ”</button>
            </div>
        </div>

        <!-- Right Section: Collection Navigation -->
        <div class="top-bar-section collection-section">
            <!-- Collection Navigation -->
            <div class="collection-nav" id="collectionNav">
                <select class="collection-select" id="collectionSelect">
                    <option value="">Select Collection</option>
                </select>
                <select class="project-select" id="projectSelect">
                    <option value="">Select Project</option>
                </select>
            </div>
        </div>

        <!-- Toggle Button -->
        <button class="top-bar-toggle" id="topBarToggle" title="Toggle Top Bar">^</button>
    </div>

    <!-- Hidden file input for JSON import -->
    <input type="file" id="jsonFileInput" accept=".json" style="display: none;">

    <!-- Main Application Content -->
    <div class="main-content">
        <div class="container">
            <h1 id="projectTitle" contenteditable="true" title="Click to rename project">ğŸ§  Mind Map</h1>
            
            <!-- Controls Panel -->
            <div class="controls" id="controls" style="display: none;">
                <button class="btn btn-success" id="saveBtn">ğŸ’¾ <span class="btn-text">Save All Changes</span></button>
                <button class="btn btn-secondary" id="toggleCommentsBtn">ğŸ’¬ <span class="btn-text">Show Comments</span></button>
                <button class="btn btn-secondary" id="toggleDatesBtn">ğŸ“… <span class="btn-text">Show Dates</span></button>
                <button class="btn btn-secondary" id="toggleAddBtn">â• <span class="btn-text">Hide Add Buttons</span></button>
                <button class="btn btn-secondary" id="toggleAllBtn">ğŸ“‚ <span class="btn-text">Toggle All</span></button>
                <button class="btn" id="toggleFlashBtn">âœ¨ <span class="btn-text">Start Flash</span></button>
                <button class="btn" id="toggleAnimateLinesBtn">ã€°ï¸ <span class="btn-text">Animate Lines</span></button>
                <button class="btn btn-info" id="toggleViewBtn">ğŸ“‹ <span class="btn-text">Board View</span></button>
                <button class="btn" id="exportBtn" style="background: #17a2b8; color: white;">ğŸ“¤ <span class="btn-text">Export JSON</span></button>
                <button class="btn" id="storyBtn" style="background: #6f42c1; color: white;">ğŸ“– <span class="btn-text">View Story</span></button>
                <button class="btn" id="moveToCollectionBtn" style="background: #28a745; color: white; display: none;">ğŸ“š <span class="btn-text" id="moveToCollectionText">Move to Collection</span></button>
            </div>

            <!-- Enhanced Progress Bar -->
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-header">
                    <div class="progress-title">ğŸ“Š Overall Progress</div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>

                <!-- Multi-segment progress bar -->
                <div class="progress-bar-wrapper">
                    <div class="progress-segments" id="progressSegments">
                        <div class="progress-segment completed" id="completedSegment" style="width: 0%" title="Click to highlight completed tasks"></div>
                        <div class="progress-segment in-progress" id="inProgressSegment" style="width: 0%" title="Click to highlight in-progress tasks"></div>
                        <div class="progress-segment pending" id="pendingSegment" style="width: 0%" title="Click to highlight pending tasks"></div>
                        <div class="progress-segment empty" id="emptySegment" style="width: 100%"></div>
                    </div>
                </div>

                <!-- Priority-weighted progress -->
                <div class="progress-priority-bars" id="priorityBars">
                    <div class="priority-bar high" title="High Priority Progress">
                        <div class="priority-bar-fill" id="highPriorityFill" style="width: 0%"></div>
                    </div>
                    <div class="priority-bar medium" title="Medium Priority Progress">
                        <div class="priority-bar-fill" id="mediumPriorityFill" style="width: 0%"></div>
                    </div>
                    <div class="priority-bar low" title="Low Priority Progress">
                        <div class="priority-bar-fill" id="lowPriorityFill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Enhanced statistics -->
                <div class="progress-stats">
                    <span class="stat completed">âœ… <span id="completedCount">0</span> Completed</span>
                    <span class="stat in-progress">ğŸ”„ <span id="inProgressCount">0</span> In Progress</span>
                    <span class="stat pending">â³ <span id="pendingCount">0</span> Pending</span>
                    <span class="stat total">ğŸ“Š <span id="totalCount">0</span> Total</span>
                </div>

                <!-- Advanced metrics -->
                <div class="progress-stats" id="advancedStats" style="margin-top: 0.5rem; font-size: 0.8rem; opacity: 0.8;">
                    <span class="stat weighted">âš–ï¸ Weighted: <span id="weightedProgress">0%</span></span>
                    <span class="stat velocity">ğŸš€ Recent Velocity: <span id="velocityIndicator">--</span></span>
                    <span class="stat forecast">ğŸ”® ETA: <span id="completionForecast">--</span></span>
                </div>
            </div>

            <!-- Mind Map Container -->
            <div class="mind-map-container" id="mindMapContainer">
                <div class="loading-indicator">
                    <div class="spinner"></div>
                    <p>Loading application...</p>
                </div>
            </div>

            <!-- Kanban Board View -->
            <div class="board-container" id="boardContainer" style="display: none;">
                <div class="board-header">
                    <h2 id="boardTitle">Project Board View</h2>
                </div>
                <div class="board-columns">
                    <div class="board-column">
                        <div class="column-header pending">
                            <h3>ğŸ“‹ To Do</h3>
                            <span class="task-count" id="todoCount">0</span>
                        </div>
                        <div class="column-content" id="todoCards"></div>
                    </div>
                    <div class="board-column">
                        <div class="column-header in-progress">
                            <h3>ğŸ”„ In Progress</h3>
                            <span class="task-count" id="inProgressBoardCount">0</span>
                        </div>
                        <div class="column-content" id="inProgressCards"></div>
                    </div>
                    <div class="board-column">
                        <div class="column-header completed">
                            <h3>âœ… Done</h3>
                            <span class="task-count" id="doneCount">0</span>
                        </div>
                        <div class="column-content" id="doneCards"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Indicator -->
    <div class="save-indicator" id="saveIndicator">âœ“ Saved</div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-priority="high">ğŸ”´ High Priority</div>
        <div class="context-menu-item" data-priority="medium">ğŸŸ¡ Medium Priority</div>
        <div class="context-menu-item" data-priority="low">ğŸŸ¢ Low Priority</div>
        <div class="context-menu-item" onclick="deleteNode(currentContextNode)">ğŸ—‘ï¸ Delete Node</div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Modal Container -->
    <div class="modal-container" id="modalContainer"></div>

    <!-- JavaScript Modules -->
    <!-- Utilities -->
    <script src="js/utils/EventBus.js"></script>
    
    <!-- Models -->
    <script src="js/models/ApiService.js"></script>
    <script src="js/models/ProjectModel.js"></script>
    <script src="js/models/CollectionModel.js"></script>
    
    <!-- Views -->
    <script src="js/views/NotificationView.js"></script>
    <script src="js/views/ModalView.js"></script>
    <script src="js/views/TopBarView.js"></script>
    <script src="js/views/MindMapView.js"></script>
    <script src="js/views/ProjectSelectorView.js"></script>
    <script src="js/views/CollectionView.js"></script>
    <script src="js/views/StoryView.js"></script>
    <script src="js/views/BoardView.js"></script>
    
    <!-- Controllers -->
    <script src="js/controllers/AppController-new.js"></script>
    <script src="js/controllers/ProjectController.js"></script>
    <script src="js/controllers/CollectionController.js"></script>
    <script src="js/controllers/UIController.js"></script>
    
    <!-- Main Application Bootstrap -->
    <script src="js/app.js"></script>
    
    <!-- Test Suite (remove in production) -->
    <script src="test-mvc.js"></script>
</body>
</html>
