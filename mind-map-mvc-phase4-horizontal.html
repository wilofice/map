<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Map - Horizontal MVC Architecture (Phase 4)</title>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <!-- CSS Module Imports -->
    <link rel="stylesheet" href="css/main-styles.css">
    <link rel="stylesheet" href="css/horizontal-layout.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/progress-styles.css">
</head>
<body>
    <div id="app">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>📁 Project Files</h2>
                <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">‹</button>
            </div>
            
            <div class="sidebar-content" id="sidebarContent">
                <!-- Working Root Directory -->
                <div class="working-root-section">
                    <div class="working-root-display">
                        <span class="folder-icon">🏠</span>
                        <span class="working-root-path" id="workingRootPath">Loading...</span>
                    </div>
                    <button class="folder-btn" id="changeRootBtn" title="Change working root directory">📂 Change Root</button>
                </div>
                
                <!-- File List -->
                <div id="fileListContainer">
                    <div class="file-list-loading">Loading files...</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-group">
                    <button class="control-btn" id="saveBtn" title="Save File">💾 Save</button>
                    <button class="control-btn" id="newFileBtn" title="New File">📄 New</button>
                    <div id="saveIndicator" class="save-indicator">Saved</div>
                </div>
                
                <div class="control-group">
                    <button class="toggle-btn" id="toggleComments" title="Toggle Comments">💬</button>
                    <button class="toggle-btn" id="toggleDates" title="Toggle Dates">📅</button>
                    <button class="toggle-btn" id="toggleAddButtons" title="Toggle Add Buttons">➕</button>
                    <button class="toggle-btn" id="toggleAll" title="Toggle All Nodes">📁</button>
                    <button class="toggle-btn" id="toggleFlash" title="Toggle Flash">✨</button>
                    <button class="toggle-btn" id="toggleAnimateLines" title="Toggle Animations">🎬</button>
                </div>
                
                <div class="control-group">
                    <button class="toggle-btn" id="toggleBoardView" title="Board View">📋</button>
                    <button class="control-btn" id="cleanupBtn" title="Cleanup IDs">🧹</button>
                </div>
            </div>

            <!-- Progress Bar -->
            <div id="progressContainer" class="progress-container" style="display: none;">
                <div class="progress-header">
                    <h3>Project Progress</h3>
                    <div class="progress-stats">
                        <span>✅ <span id="completedCount">0</span></span>
                        <span>🟡 <span id="inProgressCount">0</span></span>
                        <span>🔲 <span id="pendingCount">0</span></span>
                        <span>📊 <span id="totalCount">0</span> total</span>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar" style="width: 0%;"></div>
                    <div id="progressPercentage" class="progress-percentage">0%</div>
                </div>
            </div>

            <!-- Mind Map Container - HORIZONTAL LAYOUT -->
            <div id="mindMapContainer" class="mind-map-container">
                <div class="empty-state">
                    <h2>🧠 Horizontal Mind Map MVC (Phase 4)</h2>
                    <p>Complete MVC architecture with horizontal tree layout</p>
                    <p>Select a file from the sidebar to get started</p>
                </div>
            </div>

            <!-- Board View Container -->
            <div id="boardContainer" class="board-container" style="display: none;">
                <div class="board-columns">
                    <div class="board-column" id="pendingColumn">
                        <h3 class="column-header">🔲 Pending (<span id="pendingCount">0</span>)</h3>
                        <div class="column-content"></div>
                    </div>
                    <div class="board-column" id="inProgressColumn">
                        <h3 class="column-header">🟡 In Progress (<span id="inProgressCount">0</span>)</h3>
                        <div class="column-content"></div>
                    </div>
                    <div class="board-column" id="completedColumn">
                        <h3 class="column-header">✅ Completed (<span id="completedCount">0</span>)</h3>
                        <div class="column-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" data-priority="high">🔴 High Priority</div>
        <div class="context-menu-item" data-priority="medium">🟡 Medium Priority</div>
        <div class="context-menu-item" data-priority="low">🟢 Low Priority</div>
    </div>

    <!-- Complete MVC Module Imports -->
    <!-- Utilities -->
    <script type="module" src="js/utils/ApiClient.js"></script>
    <script type="module" src="js/utils/DOMUtils.js"></script>
    
    <!-- Models -->
    <script type="module" src="js/models/DataModel.js"></script>
    <script type="module" src="js/models/FileModel.js"></script>
    <script type="module" src="js/models/SyncModel.js"></script>
    
    <!-- Views -->
    <script type="module" src="js/views/UIRenderer.js"></script>
    <script type="module" src="js/views/BoardView.js"></script>
    <script type="module" src="js/views/SidebarView.js"></script>
    <script type="module" src="js/views/AdvancedComponents.js"></script>
    
    <!-- Controllers -->
    <script type="module" src="js/controllers/UIController.js"></script>
    <script type="module" src="js/controllers/AppController.js"></script>
    
    <!-- Legacy Components (for backward compatibility) -->
    <script type="module" src="js/progress-tracker.js"></script>
    <script type="module" src="js/node-manager.js"></script>
    
    <!-- Main App Entry Point -->
    <script type="module">
        import { apiClient } from './js/utils/ApiClient.js';
        import { dataModel } from './js/models/DataModel.js';
        import { fileModel } from './js/models/FileModel.js';
        import { syncModel } from './js/models/SyncModel.js';
        import { uiRenderer } from './js/views/UIRenderer.js';
        import { boardView } from './js/views/BoardView.js';
        import { sidebarView } from './js/views/SidebarView.js';
        import { advancedComponents } from './js/views/AdvancedComponents.js';
        import { uiController } from './js/controllers/UIController.js';
        import { appController } from './js/controllers/AppController.js';
        import { DOMUtils } from './js/utils/DOMUtils.js';
        
        // Phase 4 - Complete Horizontal MVC Application with Full Controller Separation
        async function initializeApp() {
            console.log('🚀 Initializing Horizontal Mind Map MVC App (Phase 4)...');
            console.log('📋 Features: Horizontal Layout, Complete MVC, Full Controller Separation');
            
            // Inject dependencies into the app controller
            appController.injectDependencies({
                apiClient,
                dataModel,
                fileModel,
                syncModel,
                uiRenderer,
                boardView,
                sidebarView,
                advancedComponents,
                uiController,
                DOMUtils
            });
            
            // Initialize the application
            await appController.init();
            
            console.log('✅ Horizontal Mind Map MVC App initialized successfully!');
        }
        
        // Start the application
        initializeApp();
        
        // Make app globally available for debugging
        window.mindMapApp = appController;
        window.mvc = {
            app: appController,
            models: { dataModel, fileModel, syncModel },
            views: { uiRenderer, boardView, sidebarView, advancedComponents },
            controllers: { uiController, appController },
            utils: { apiClient, DOMUtils }
        };
        
        console.log('🎯 Global MVC object available at window.mvc');
        console.log('🌳 Horizontal tree layout active - nodes flow left to right');
    </script>
</body>
</html>